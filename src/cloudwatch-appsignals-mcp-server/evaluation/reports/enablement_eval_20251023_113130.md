# Application Signals Enablement Evaluation Report

**Generated:** 2025-10-23 11:31:29
**Task:** ec2_python_flask
**Platform:** ec2
**Language:** python

---

## Summary

- **Overall Result:** ✅ PASS
- **Duration:** 126.56s
- **Turns:** 7

---

## Metrics

- **Hit Rate:** 100.0%
- **Success Rate:** 100.0%
- **Unnecessary Tool Calls:** 0
- **File Operations:** 12
- **Total Tool Calls:** 13

---

## Tool Call Trace

1. ✅ `enable_application_signals` (0.01s)
   - platform: ec2
   - language: python
   - iac_directory: infrastructure/ec2/cdk
   - app_directory: sample-apps/python/flask

2. ✅ `list_files` (0.00s)
   - path: infrastructure/ec2/cdk

3. ✅ `list_files` (0.00s)
   - path: infrastructure/ec2/cdk/lib

4. ✅ `read_file` (0.00s)
   - path: infrastructure/ec2/cdk/lib/cdk-stack.ts

5. ✅ `list_files` (0.00s)
   - path: sample-apps/python/flask

6. ✅ `read_file` (0.00s)
   - path: sample-apps/python/flask/app.py

7. ✅ `read_file` (0.00s)
   - path: sample-apps/python/flask/Dockerfile

8. ✅ `read_file` (0.00s)
   - path: sample-apps/python/flask/requirements.txt

9. ✅ `list_files` (0.00s)
   - path: infrastructure/ec2/cdk/config

10. ✅ `read_file` (0.00s)
   - path: infrastructure/ec2/cdk/config/python-flask.json

11. ✅ `write_file` (0.00s)
   - path: infrastructure/ec2/cdk/lib/cdk-stack.ts
   - content: import * as cdk from 'aws-cdk-lib';
import * as ec2 from 'aws-cdk-lib/aws-ec2';
import * as iam from...

12. ✅ `write_file` (0.00s)
   - path: sample-apps/python/flask/Dockerfile
   - content: FROM python:3.11-slim

WORKDIR /app

# Install curl for traffic generation
RUN apt-get update && apt...

13. ✅ `write_file` (0.00s)
   - path: sample-apps/python/flask/requirements.txt
   - content: flask==3.0.0
boto3==1.34.0
aws-opentelemetry-distro


---

## Validation Results

### LLM-as-Judge Assessment


**✅ PASS:** CloudWatchAgentServerPolicy IAM managed policy is attached to the EC2 instance role in the CDK stack

_The CloudWatchAgentServerPolicy IAM managed policy is correctly added to the EC2 instance role's managedPolicies array in the CDK stack._


**✅ PASS:** aws-opentelemetry-distro Python package is added to the project's dependency specification (check requirements.txt, pyproject.toml, or Dockerfile pip install commands)

_The aws-opentelemetry-distro package is added to both requirements.txt and installed via pip in the Dockerfile, satisfying the dependency specification requirement._


**✅ PASS:** If the application uses Docker, verify the Dockerfile includes aws-opentelemetry-distro installation

_The Dockerfile includes both a RUN command to install aws-opentelemetry-distro and modifies the CMD to use opentelemetry-instrument for auto-instrumentation._


**✅ PASS:** Modified files have no syntax errors (TypeScript, Python, YAML, JSON, etc.)

_All modified files show proper syntax with correct TypeScript structure, valid Dockerfile commands, and properly formatted requirements.txt._


**✅ PASS:** Existing code is preserved with no major unintended deletions or breaking changes

_The changes are purely additive, preserving all existing functionality while only adding Application Signals configuration and dependencies without any deletions or breaking modifications._


---

## Git Diff

```diff
diff --git a/infrastructure/ec2/cdk/lib/cdk-stack.ts b/infrastructure/ec2/cdk/lib/cdk-stack.ts
index cba7d4f..e872651 100644
--- a/infrastructure/ec2/cdk/lib/cdk-stack.ts
+++ b/infrastructure/ec2/cdk/lib/cdk-stack.ts
@@ -25,13 +25,14 @@ export class EC2AppStack extends cdk.Stack {
       isDefault: true,
     });
 
-    // IAM role for EC2 with S3 read permissions, ECR pull, and SSM access
+    // IAM role for EC2 with S3 read permissions, ECR pull, SSM access, and CloudWatch Agent
     const role = new iam.Role(this, 'AppRole', {
       assumedBy: new iam.ServicePrincipal('ec2.amazonaws.com'),
       managedPolicies: [
         iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonS3ReadOnlyAccess'),
         iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonSSMManagedInstanceCore'),
         iam.ManagedPolicy.fromAwsManagedPolicyName('AmazonEC2ContainerRegistryReadOnly'),
+        iam.ManagedPolicy.fromAwsManagedPolicyName('CloudWatchAgentServerPolicy'),
       ],
     });
 
@@ -48,15 +49,45 @@ export class EC2AppStack extends cdk.Stack {
       `Allow access to ${config.appName} on port ${config.port}`
     );
 
-    // User data to pull Docker image and run container
+    // User data to pull Docker image and run container with Application Signals
     const userData = ec2.UserData.forLinux();
     userData.addCommands(
       '#!/bin/bash',
       'set -e',
       '',
-      '# Update and install dependencies',
+      '# Update and install dependencies (including wget for CloudWatch Agent)',
       'yum update -y',
-      'yum install -y docker',
+      'yum install -y wget docker python3-pip',
+      '',
+      '# Download and install CloudWatch Agent',
+      'wget https://s3.amazonaws.com/amazoncloudwatch-agent/amazon_linux/amd64/latest/amazon-cloudwatch-agent.rpm',
+      'rpm -U ./amazon-cloudwatch-agent.rpm',
+      '',
+      '# Create CloudWatch Agent configuration for Application Signals',
+      'cat > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json << EOF',
+      '{',
+      '  "traces": {',
+      '    "traces_collected": {',
+      '      "application_signals": {}',
+      '    }',
+      '  },',
+      '  "logs": {',
+      '    "metrics_collected": {',
+      '      "application_signals": {}',
+      '    }',
+      '  }',
+      '}',
+      'EOF',
+      '',
+      '# Start CloudWatch Agent with Application Signals configuration',
+      '/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl \\',
+      '  -a fetch-config \\',
+      '  -m ec2 \\',
+      '  -s \\',
+      '  -c file:/opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json',
+      '',
+      '# Install ADOT Python auto-instrumentation',
+      'pip3 install aws-opentelemetry-distro',
       '',
       '# Start Docker service',
       'systemctl start docker',
@@ -69,12 +100,24 @@ export class EC2AppStack extends cdk.Stack {
       '# Pull Docker image',
       `docker pull ${ecrImageUri}`,
       '',
-      '# Run container',
+      '# Run container with Application Signals environment variables',
       `docker run -d --name ${config.appName} \\`,
       `  -p ${config.port}:${config.port} \\`,
       `  -e PORT=${config.port} \\`,
       `  -e SERVICE_NAME=${config.serviceName} \\`,
       `  -e AWS_REGION=${this.region} \\`,
+      `  -e OTEL_METRICS_EXPORTER=none \\`,
+      `  -e OTEL_LOGS_EXPORTER=none \\`,
+      `  -e OTEL_AWS_APPLICATION_SIGNALS_ENABLED=true \\`,
+      `  -e OTEL_PYTHON_DISTRO=aws_distro \\`,
+      `  -e OTEL_PYTHON_CONFIGURATOR=aws_configurator \\`,
+      `  -e OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf \\`,
+      `  -e OTEL_TRACES_SAMPLER=xray \\`,
+      `  -e OTEL_TRACES_SAMPLER_ARG=endpoint=http://localhost:2000 \\`,
+      `  -e OTEL_AWS_APPLICATION_SIGNALS_EXPORTER_ENDPOINT=http://localhost:4316/v1/metrics \\`,
+      `  -e OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=http://localhost:4316/v1/traces \\`,
+      `  -e OTEL_RESOURCE_ATTRIBUTES=service.name=${config.serviceName} \\`,
+      `  --network host \\`,
       `  ${ecrImageUri}`,
       '',
       '# Wait for application to start',
@@ -83,7 +126,7 @@ export class EC2AppStack extends cdk.Stack {
       '# Start traffic generator inside container',
       `docker exec -d ${config.appName} bash /app/generate-traffic.sh`,
       '',
-      'echo "Application deployed and traffic generation started"'
+      'echo "Application deployed with Application Signals and traffic generation started"'
     );
 
     // EC2 instance
@@ -132,5 +175,10 @@ export class EC2AppStack extends cdk.Stack {
       value: config.language,
       description: 'Application language',
     });
+
+    new cdk.CfnOutput(this, 'ApplicationSignalsEnabled', {
+      value: 'true',
+      description: 'Application Signals enabled for this deployment',
+    });
   }
-}
+}
\ No newline at end of file
diff --git a/sample-apps/python/flask/Dockerfile b/sample-apps/python/flask/Dockerfile
index 66bfad9..810124d 100644
--- a/sample-apps/python/flask/Dockerfile
+++ b/sample-apps/python/flask/Dockerfile
@@ -8,6 +8,9 @@ RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*
 COPY requirements.txt .
 RUN pip install --no-cache-dir -r requirements.txt
 
+# Install AWS OpenTelemetry Distro for Application Signals
+RUN pip install --no-cache-dir aws-opentelemetry-distro
+
 COPY . .
 
 ENV PORT=5000
@@ -15,4 +18,5 @@ ENV SERVICE_NAME=python-flask-app
 
 EXPOSE 5000
 
-CMD ["python", "app.py"]
+# Use OpenTelemetry auto-instrumentation to start the application
+CMD ["opentelemetry-instrument", "python", "app.py"]
\ No newline at end of file
diff --git a/sample-apps/python/flask/requirements.txt b/sample-apps/python/flask/requirements.txt
index 1bdd3f5..60e5104 100644
--- a/sample-apps/python/flask/requirements.txt
+++ b/sample-apps/python/flask/requirements.txt
@@ -1,2 +1,3 @@
 flask==3.0.0
 boto3==1.34.0
+aws-opentelemetry-distro
\ No newline at end of file

```